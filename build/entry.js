const fs = require('fs');
const path = require('path');

const packagePath = path.resolve(__dirname, '../src/packages');
const packageNames = fs.readdirSync(packagePath);

let writeImport = '';
let writeComponents = 'const components = [\n';
packageNames.forEach((packageName, index) => {
  writeImport += `import Zm${packageName} from './packages/${packageName}';\n`;
  writeComponents += `  Zm${packageName},\n`;
  if (index === packageNames.length - 1) {
    writeComponents += '];';
  }
});

// eslint-disable-next-line operator-linebreak
const writeContent =
`/* Automatically generated by '/build/entry.js */

${writeImport}
${writeComponents}

const install = (app) => {
  components.forEach((component) => {
    app.component(component.name, component);
  });
};

export default {
  install,
  ...components,
};
`;

const outputPath = path.resolve(__dirname, '../src/index.js');

if (fs.existsSync(outputPath)) {
  fs.writeFileSync(outputPath, writeContent);
} else {
  fs.appendFileSync(outputPath, writeContent);
}
